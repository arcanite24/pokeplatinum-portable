# Resource Management - SDL3 Port

## Overview

The SDL3 port uses a **clean separation** between code and game assets. Users must extract assets from their own legally obtained ROM - we do not ship copyrighted game data.

## Directory Structure

### `/resources/` (Runtime Assets - GITIGNORED)

**Purpose:** SDL3 runtime assets extracted from user's legal ROM copy

**Structure:**
```
resources/
├── graphics/           # Game graphics
│   ├── title_screen/   # Named, converted files (tiles.bin, .pal)
│   ├── title_screen_raw/ # Raw NARC members (0000.bin, 0001.bin, ...)
│   ├── battle/         # Battle system graphics (future)
│   └── field/          # Field/map graphics (future)
├── audio/              # Converted audio (future)
│   ├── bgm/            # Background music (OGG/WAV)
│   └── sfx/            # Sound effects
├── text/               # Text/message banks (future)
└── data/               # Other game data (future)
```

**Status:** Gitignored - not included in repository  
**Generated by:** `tools/convert_assets.sh` from ROM  
**Required for:** SDL3 build to run  

### `/res/` (DS Build Assets - REFERENCE ONLY)

**Purpose:** Original DS build assets (used by Meson build)

**Usage:**
- Reference for implementation patterns
- Study asset structure and formats
- **SDL3 code must NOT depend on this directory**

**Status:** Committed to repository (build system reference)  
**Used by:** Original DS build only (not SDL3)

### `/build/` (DS Build Output - DO NOT USE)

**Purpose:** Generated by Meson for DS target

**Usage:**
- **SDL3 code must NOT reference this directory**
- Contains DS ROM build artifacts
- SDL3 uses `build-sdl/` instead

**Status:** Gitignored build output  
**Generated by:** `make` (DS build)

### `/build-sdl/` (SDL3 Build Output)

**Purpose:** SDL3 build artifacts

**Usage:**
- CMake output directory for SDL3 build
- Contains `pokeplatinum_sdl` executable

**Status:** Gitignored build output  
**Generated by:** `./build_sdl.sh` or CMake

### `/tools/` (Asset Extraction Scripts)

**Purpose:** Convert ROM data to SDL-compatible formats

**Key Scripts:**
- `convert_assets.sh` - Main extraction script (runs all conversions)
- `narc_extractor.py` - Extract NARC archives from ROM
- `ncgr_converter.py` - Convert NCGR graphics to raw tiles
- `nclr_converter.py` - Convert NCLR palettes to RGB555
- `convert_title_screen.py` - Title screen specific extraction

**Usage:**
```bash
./tools/convert_assets.sh path/to/platinum.us.nds
```

## Asset Loading in SDL3 Code

### Correct Pattern ✅

```c
// Always reference resources/ directory
char path[512];
GetAssetPath(narcID, memberIdx, "tiles.bin", path, sizeof(path));
// Result: "resources/graphics/title_screen/logo_tiles.bin"

PAL_File file = PAL_File_Open(path, "rb");
// Loads from extracted assets
```

### Incorrect Patterns ❌

```c
// WRONG - Don't reference res/ (DS build only)
PAL_File file = PAL_File_Open("res/graphics/title_screen/logo.png", "rb");

// WRONG - Don't reference build/ (DS output only)
PAL_File file = PAL_File_Open("build/res/graphics/.../logo.NCGR", "rb");

// WRONG - Don't hardcode absolute paths
PAL_File file = PAL_File_Open("/Users/me/project/resources/...", "rb");
```

## Extending the Asset System

As more game systems are ported, follow this pattern:

### 1. Create Extraction Tool

Add a new converter to `tools/`:

```python
# tools/convert_battle_graphics.py
def extract_battle_narc(rom_path, output_dir):
    # Extract NARC_INDEX_BATTLE_GRAPHICS
    # Convert NCGR/NCLR to .bin/.pal
    # Output to resources/graphics/battle/
    pass
```

### 2. Update GetAssetPath()

Add mapping in `src/graphics.c`:

```c
else if (narcID == NARC_INDEX_BATTLE_GRAPHICS) {
    narcPath = "resources/graphics/battle";
    switch (narcMemberIdx) {
        case 0: assetName = "battle_bg"; break;
        case 1: assetName = "pokemon_sprites"; break;
        // ... more mappings
    }
    snprintf(outPath, pathSize, "%s/%s_%s", narcPath, assetName, assetType);
    return;
}
```

### 3. Update Main Extraction Script

Add to `tools/convert_assets.sh`:

```bash
echo "Extracting battle graphics..."
python3 "$TOOLS_DIR/convert_battle_graphics.py" "$ROM_PATH" "$RESOURCES_DIR/graphics/battle"
```

## Scalability

This resource management strategy is designed to be **scalable**:

1. **Incremental Extraction:** Extract only what's needed for current porting phase
2. **Modular Tools:** Each subsystem has its own extraction tool
3. **Clear Separation:** Code never depends on `/res/` or `/build/`
4. **User Responsibility:** Users provide their own ROM (legal compliance)
5. **Version Control:** Assets are gitignored, code is versioned

## Asset Format Standards

### Graphics
- **Tiles:** Raw binary (8x8 pixels, 4bpp or 8bpp)
- **Palettes:** RGB555 format (.pal files, 2 bytes per color)
- **Tilemaps:** Raw tilemap indices (.bin files)

### Audio (Future)
- **Music:** OGG Vorbis or WAV
- **Sound Effects:** WAV (16-bit, 44.1kHz)

### Text (Future)
- **Messages:** UTF-8 text files or binary message banks

## Testing Asset Extraction

```bash
# 1. Extract title screen (example)
./tools/convert_title_screen.py platinum.us.nds resources/graphics/title_screen

# 2. Verify files exist
ls -lh resources/graphics/title_screen/
# Should show: logo_top_tiles.bin, palette_1.pal, etc.

# 3. Test in-game
./build-sdl/pokeplatinum_sdl
# Check console for successful asset loads
```

## Legal Compliance

**Important:** This repository does NOT include copyrighted game assets.

- Users must extract from their own legally obtained ROM
- `resources/` directory is gitignored
- Distribution of extracted assets is prohibited
- See [pret/pokeplatinum](https://github.com/pret/pokeplatinum) for original project

---

**Last Updated:** November 15, 2025  
**Status:** Phase 3.4 (Game Integration) - Title Screen Assets Working
